<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="tESWZeJGAbrEJ5FMhd3UT_9J0uXdV9MP1jNSv3dRGi4">
  <meta name="baidu-site-verification" content="87zOg36R4nAIIjPP">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ilongda.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="总结将8月份写的离线安装文档, share 出来. 后续可能会发一系列的使用文档.  本文将以线上业务运行OceanBase为目标, 部署分布式版本, 如果想简单测试和试用OceanBase, 请参考https:&#x2F;&#x2F;open.oceanbase.com&#x2F;quickStart​ 安装流程​">
<meta property="og:type" content="article">
<meta property="og:title" content="OceanBase离线安装">
<meta property="og:url" content="http://ilongda.com/2021/ob_offline_install/index.html">
<meta property="og:site_name" content="Longda share space">
<meta property="og:description" content="总结将8月份写的离线安装文档, share 出来. 后续可能会发一系列的使用文档.  本文将以线上业务运行OceanBase为目标, 部署分布式版本, 如果想简单测试和试用OceanBase, 请参考https:&#x2F;&#x2F;open.oceanbase.com&#x2F;quickStart​ 安装流程​">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ilongda.com/img/ob/install1.jpg">
<meta property="og:image" content="http://ilongda.com/img/ob/install2.png">
<meta property="og:image" content="http://ilongda.com/img/ob/install3.png">
<meta property="og:image" content="http://ilongda.com/img/ob/install4.png">
<meta property="og:image" content="http://ilongda.com/img/ob/install5.png">
<meta property="og:image" content="http://ilongda.com/img/ob/install6.png">
<meta property="og:image" content="http://ilongda.com/img/ob/install7.png">
<meta property="article:published_time" content="2021-11-20T03:42:57.000Z">
<meta property="article:modified_time" content="2024-01-29T09:18:27.033Z">
<meta property="article:author" content="Longda Feng">
<meta property="article:tag" content="OceanBase">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ilongda.com/img/ob/install1.jpg">


<link rel="canonical" href="http://ilongda.com/2021/ob_offline_install/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh_CN","comments":true,"permalink":"http://ilongda.com/2021/ob_offline_install/","path":"2021/ob_offline_install/","title":"OceanBase离线安装"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OceanBase离线安装 | Longda share space</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83056277-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-83056277-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?c455e54be1a88d1bcdb8c57d2739bca0"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Longda share space" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Longda share space</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Sharing</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        
            
  <li class="menu-item menu-item-知识库"><a href="/knowledge/" rel="section"><i class="fa fa-book fa-fw"></i>知识库</a></li>


      
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">安装流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">3.</span> <span class="nav-text">安装前准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-number">3.1.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.2.</span> <span class="nav-text">部署模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AF%E7%A1%AC%E4%BB%B6%E8%A6%81%E6%B1%82"><span class="nav-number">3.3.</span> <span class="nav-text">软硬件要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%A0%E5%AF%86%E7%A0%81SSH-%E7%99%BB%E5%BD%95"><span class="nav-number">3.4.</span> <span class="nav-text">设置无密码SSH 登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7"><span class="nav-number">3.5.</span> <span class="nav-text">创建使用用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E8%A7%84%E5%88%92"><span class="nav-number">3.6.</span> <span class="nav-text">磁盘规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E6%A3%80%E6%9F%A5"><span class="nav-number">3.7.</span> <span class="nav-text">预检查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="nav-number">3.7.1.</span> <span class="nav-text">检查操作系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E5%86%85%E5%AD%98"><span class="nav-number">3.7.2.</span> <span class="nav-text">检查内存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%A3%81%E7%9B%98"><span class="nav-number">3.8.</span> <span class="nav-text">检查磁盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0"><span class="nav-number">3.9.</span> <span class="nav-text">检查网卡名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AElimits-conf"><span class="nav-number">3.10.</span> <span class="nav-text">配置limits.conf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E2%80%9Csysctl-conf%E2%80%9D%E6%96%87%E4%BB%B6"><span class="nav-number">3.11.</span> <span class="nav-text">配置“sysctl.conf”文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C-SELinux"><span class="nav-number">3.12.</span> <span class="nav-text">关闭防火墙和 SELinux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#firewalld%E5%85%B3%E9%97%AD"><span class="nav-number">3.12.1.</span> <span class="nav-text">firewalld关闭</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selinux%E5%85%B3%E9%97%AD"><span class="nav-number">3.12.2.</span> <span class="nav-text">selinux关闭</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5"><span class="nav-number">3.13.</span> <span class="nav-text">设置时钟同步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5"><span class="nav-number">3.13.1.</span> <span class="nav-text">检查时钟同步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5"><span class="nav-number">3.13.2.</span> <span class="nav-text">配置时钟同步</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">4.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%8C%85%E7%BB%84%E4%BB%B6"><span class="nav-number">4.1.</span> <span class="nav-text">安装包组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85OBD"><span class="nav-number">4.2.</span> <span class="nav-text">安装OBD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85"><span class="nav-number">4.2.1.</span> <span class="nav-text">在线安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85"><span class="nav-number">4.2.2.</span> <span class="nav-text">本地安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85OBLibs"><span class="nav-number">4.3.</span> <span class="nav-text">安装OBLibs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85-1"><span class="nav-number">4.3.1.</span> <span class="nav-text">在线安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85-1"><span class="nav-number">4.3.2.</span> <span class="nav-text">本地安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85OBServer-OBProxy"><span class="nav-number">4.4.</span> <span class="nav-text">安装OBServer &amp; OBProxy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86OceanBase%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%A6%BB%E7%BA%BF%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%8A%A0%E5%85%A5%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="nav-number">4.4.1.</span> <span class="nav-text">将OceanBase数据库的离线软件包加入本地镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.2.</span> <span class="nav-text">下载配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.3.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85"><span class="nav-number">4.4.4.</span> <span class="nav-text">开始安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="nav-number">4.5.</span> <span class="nav-text">修改配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E2%80%8B"><span class="nav-number">5.</span> <span class="nav-text">验证​</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85obclient"><span class="nav-number">5.1.</span> <span class="nav-text">安装obclient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85-2"><span class="nav-number">5.1.1.</span> <span class="nav-text">在线安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85-2"><span class="nav-number">5.1.2.</span> <span class="nav-text">本地安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85mysql-%E5%BC%80%E5%8F%91%E5%8C%85"><span class="nav-number">5.2.</span> <span class="nav-text">安装mysql 开发包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%A7%9F%E6%88%B7"><span class="nav-number">5.3.</span> <span class="nav-text">检查租户</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E7%94%A8%E6%88%B7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">6.</span> <span class="nav-text">企业用户最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A3%81%E7%9B%98"><span class="nav-number">6.1.</span> <span class="nav-text">磁盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E4%BE%9D%E8%B5%96"><span class="nav-number">6.2.</span> <span class="nav-text">时钟依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%97%B6%E5%BB%B6"><span class="nav-number">6.3.</span> <span class="nav-text">网络时延</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.4.</span> <span class="nav-text">参数设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%9F%E6%88%B7%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.4.1.</span> <span class="nav-text">租户设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#obproxy%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.2.</span> <span class="nav-text">obproxy配置</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Longda Feng" src="/img/my.jpg">
  <p class="site-author-name" itemprop="name">Longda Feng</p>
  <div class="site-description" itemprop="description">Longda share space</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/longdafeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;longdafeng" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hustjackie@sohu.com" title="E-Mail → mailto:hustjackie@sohu.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh_CN">
    <link itemprop="mainEntityOfPage" href="http://ilongda.com/2021/ob_offline_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/my.jpg">
      <meta itemprop="name" content="Longda Feng">
      <meta itemprop="description" content="Longda share space">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longda share space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OceanBase离线安装
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-20 11:42:57" itemprop="dateCreated datePublished" datetime="2021-11-20T11:42:57+08:00">2021-11-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2024-01-29 17:18:27" itemprop="dateModified" datetime="2024-01-29T17:18:27+08:00">2024-01-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OceanBase/" itemprop="url" rel="index"><span itemprop="name">OceanBase</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>将8月份写的离线安装文档, share 出来. 后续可能会发一系列的使用文档. </p>
<p>本文将以线上业务运行OceanBase为目标, 部署分布式版本, 如果想简单测试和试用OceanBase, 请参考<a target="_blank" rel="noopener" href="https://open.oceanbase.com/quickStart">https://open.oceanbase.com/quickStart</a><br>​</p>
<h1 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h1><p>​<img data-src="/img/ob/install1.jpg"></p>
<span id="more"></span>

<h1 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h1><p>安装前, 均使用root 进行操作, 安装过程中, 可以使用对应的普通用户</p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>OBD: OceanBase Deployer,   OceanBase 部署工具</li>
<li>主控机: 运行OBD 安装包机器</li>
<li>OBServer : 每台安装 OceanBase 的物理机上面运行的 OceanBase 数据库进程&#x2F;服务，称为 OBServer  	</li>
<li>OBProxy : OceanBase Proxy, 是 OceanBase 高性能反向代理服务器，具有防连接闪断、 屏蔽后端异常(宕机、升级、网络抖动)、MySQL 协议兼容、强校 验、支持热升级和多集群等功能<br>​</li>
</ul>
<h2 id="部署模式"><a href="#部署模式" class="headerlink" title="部署模式"></a>部署模式</h2><p>在本例采用经典的三幅本部署模式, 使用4台机器:</p>
<ul>
<li>1台机器 部署 OBProxy  – 推荐客户端应用和OBProxy 部署一起, 减少第一次网络时延.</li>
<li>1-1-1 部署3副本OceanBase 集群, 每个zone 表示一个副本, 在本例中, 一个zone 只包含一台机器. 3个zone 可以生产环境中常常部署两地三中心模式, 三个机房三个副本, 每个机房一个副本, 其中两个机房距离较近.</li>
</ul>
<p>​</p>
<h2 id="软硬件要求"><a href="#软硬件要求" class="headerlink" title="软硬件要求"></a>软硬件要求</h2><table>
<thead>
<tr>
<th>项目</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>系统</td>
<td>Red Hat Enterprise Linux Server 7.x 版本（内核 Linux 3.10.0 版本及以上） <br>CentOS Linux 7.x 版本（内核 Linux 3.10.0 版本及以上）<br> Anolis OS 8.x 版本（内核 Linux 3.10.0 版本及以上）</td>
</tr>
<tr>
<td>CPU</td>
<td>企业级用户最低要求16核, 推荐32核及以上 <br>个人测试最低要求2核, 推荐8核及以上</td>
</tr>
<tr>
<td>内存</td>
<td>企业级应用最低要求64G,  推荐256G 及以上 <br>个人测试最低要求8G, 推荐64G 及以上</td>
</tr>
<tr>
<td>磁盘类型</td>
<td>推荐SSD</td>
</tr>
<tr>
<td>磁盘空间</td>
<td>内存大小的4倍及以上</td>
</tr>
<tr>
<td>文件系统</td>
<td>ext4或xfs, 当数据量超过16TB时, 使用xfs</td>
</tr>
<tr>
<td>网卡</td>
<td>千兆互联及以上</td>
</tr>
</tbody></table>
<h2 id="设置无密码SSH-登录"><a href="#设置无密码SSH-登录" class="headerlink" title="设置无密码SSH 登录"></a>设置无密码SSH 登录</h2><p>在安装前, 需要对每台机器的环境进行设置, 这些设置都需在超级管理员下操作, 建议打通 主控机器 到OBServer 和OBProxy 机器的信任登陆(即无密码登录), 如何设置无密码SSH 登录, 详情参考 <a target="_blank" rel="noopener" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/optional-set-password-free-ssh-logon">https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/optional-set-password-free-ssh-logon</a><br>​</p>
<p>推荐2个脚本, 方便在集群中批量执行命令和拷贝文件<br>批量拷贝文件,  可以将host list 换成自己实际机器列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#/usr/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hosts=(</span><br><span class="line">    &quot;ob001&quot;</span><br><span class="line">    &quot;ob002&quot;</span><br><span class="line">    &quot;ob003&quot;</span><br><span class="line">    &quot;obdriver&quot;</span><br><span class="line">    )</span><br><span class="line">    for host in &quot;$&#123;hosts[@]&#125;&quot;</span><br><span class="line">    do</span><br><span class="line"></span><br><span class="line">        echo &quot;begin to scp &quot; $@ &quot; on &quot; $host</span><br><span class="line">        scp -r $1 $host:$2</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>
<p>批量执行命令, 可以将host list  换成自己实际的机器列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hosts=(</span><br><span class="line">    &quot;ob001&quot;</span><br><span class="line">    &quot;ob002&quot;</span><br><span class="line">    &quot;ob003&quot;</span><br><span class="line">    &quot;obdriver&quot;</span><br><span class="line">    )</span><br><span class="line">    for host in &quot;$&#123;hosts[@]&#125;&quot;</span><br><span class="line">    do</span><br><span class="line">        echo &quot;begin to run &quot; $@ &quot; on &quot; $host</span><br><span class="line">        ssh $host $@</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>


<h2 id="创建使用用户"><a href="#创建使用用户" class="headerlink" title="创建使用用户"></a>创建使用用户</h2><p>对于个人测试用户, 可以直接使用root 账号, 对于企业用户, 推荐创新普通用户, 避免对系统照成安全冲击.  在本例中, 使用admin 作为示范, 企业用户可以根据自己需要, 使用自己常用的账户<br>​</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -U admin -d /home/admin -s /bin/bash</span><br><span class="line">mkdir -p /home/admin</span><br><span class="line">sudo chown -R admin:admin /home/admin</span><br></pre></td></tr></table></figure>


<p>设置密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd admin</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>设置sudo 权限<br>vi &#x2F;etc&#x2F;sudoers      #添加oceanbase一行内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## Same thing without a password</span><br><span class="line"># %wheel        ALL=(ALL)       NOPASSWD: ALL</span><br><span class="line">admin       ALL=(ALL)       NOPASSWD: ALL</span><br></pre></td></tr></table></figure>


<h2 id="磁盘规划"><a href="#磁盘规划" class="headerlink" title="磁盘规划"></a>磁盘规划</h2><p>OceanBase 数据库服务器依赖3个目录,   当个人测试使用时, 可以将所有数据放到1块盘下, 但在企业级用户中, 必须分别挂载3块磁盘: 数据盘, 事务日志盘, OBServer 安装盘. 当机器上没有3块盘时或者使用RAID 磁盘阵列时,  需要对磁盘或者磁盘阵列的逻辑卷进行分区, 分3块分区, 分区大小参考下面说明:</p>
<ul>
<li><p>数据盘</p>
<ul>
<li>配置参数为data_dir.  要根据业务需要，做好数据盘的规划. 数据盘承载了基线数据，物理上只有一个基线数据文件 block_file，在安装目录 store&#x2F;sstable 下。通过 OBServer 进程启动时一 次性创建，大小根据启动参数 datafile_disk_percentage 采用磁盘预分 配策略，默认值为 95%，创建后无法调整大小。OceanBase 的扩容缩 容采用加减机器的策略，目前不支持单机的磁盘级扩容和缩容。</li>
</ul>
</li>
<li><p>事务日志盘</p>
<ul>
<li>配置参数为redo_dir.  推荐大小为OBServer 内存3到4倍或以上. 事务日志盘包含多个固定大小的小文件，位于安装目录 store&#x2F;{clog,ilog,slog}，按需自动创建和清除，磁盘写到 80%会触发自 清除逻辑，但前提是这部分日志数据对应的内存数据已经通过合并融 合到了基线数据中，才能被删除。同等数据量， 事务日志的大小约为内存数据大小的三倍。所以事务日志盘所需空间 上限与两次合并操作间的业务数据总量成正比，经验公式是:事务日 志文件大小 &#x3D; 增量数据内存上限的 3 到 4 倍。</li>
</ul>
</li>
<li><p>OBServer 安装盘</p>
<ul>
<li><p>配置参数home_path. 推荐200G 或以上(保存7天或以上的日志量). OceanBase 的 rpm 包安装目录在&#x2F;home&#x2F;admin&#x2F;oceanbase 下，其中 基线数据文件和事务日志文件会通过软连接指向上述的两个独立磁 盘，还有另外一个不断增长的文件是 OB 运行日志，在安装目录 log 下。OB 进程本身无法自删除运行日志，需要定时任务或运维脚本完 成删除逻辑。 </p>
<p>磁盘划分后, 可以通过df -h 命令检查, 结果如下:</p>
</li>
</ul>
</li>
</ul>
<p>​<img data-src="/img/ob/install2.png"><br>在本示例中: &#x2F;data 为数据磁盘, 大小1TB, &#x2F;redo 存放 redo 日志,  &#x2F;home&#x2F;admin&#x2F;oceanbase 存放oceanbase binary 和运行日志<br>​</p>
<p>检查目录权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls –al #执行该命令</span><br><span class="line">drwxr-xr-x 2 admin admin 4096 2 月 9 18:43 </span><br><span class="line">drwxr-xr-x 2 admin admin 4096 2 月 9 18:43 log1</span><br><span class="line"></span><br><span class="line">若 admin 用户无权限，则以 root 用户执行如下命令 </span><br><span class="line">chown -R admin:admin /data</span><br><span class="line">chown -R admin:admin /redo</span><br><span class="line">chown -R admin:admin /home/admin</span><br></pre></td></tr></table></figure>
<p>​</p>
<h2 id="预检查"><a href="#预检查" class="headerlink" title="预检查"></a>预检查</h2><p>企业级用户建议运行OBServer 所有机器硬件配置和软件配置(操作系统, 操作系统内核, glibc, python 等软件包) 一致, OBProxy 机器和OBServer 机器软件配置一致(操作系统, 操作系统内核, glibc, python等软件包). </p>
<h3 id="检查操作系统"><a href="#检查操作系统" class="headerlink" title="检查操作系统"></a>检查操作系统</h3><p>当前支持的操作系统为:<br>​</p>
<p>Red Hat Enterprise Linux Server 7.x 版本（内核 Linux 3.10.0 版本及以上）<br>CentOS Linux 7.x 版本（内核 Linux 3.10.0 版本及以上）<br>​</p>
<ol>
<li>以root 用户登录服务器</li>
<li>查看os 版本</li>
</ol>
<p>		 				</p>
<p>RedHat7 系统显示如下 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@redhat-04 /root]#cat /etc/redhat-release</span><br><span class="line">Red Hat Enterprise Linux Server release 7.2 (Maipo)</span><br></pre></td></tr></table></figure>
<p>CentOS7 系统显示如下: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-01 /root]#cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br></pre></td></tr></table></figure>
<p>在anolis 系统上:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@anolis ~]# cat /etc/os-release</span><br><span class="line">NAME=&quot;Anolis OS&quot;</span><br><span class="line">VERSION=&quot;8.2&quot;</span><br><span class="line">ID=&quot;anolis&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora centos&quot;</span><br><span class="line">VERSION_ID=&quot;8.2&quot;</span><br><span class="line">PLATFORM_ID=&quot;platform:an8&quot;</span><br><span class="line">PRETTY_NAME=&quot;Anolis OS 8.2&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">HOME_URL=&quot;https://openanolis.org/&quot;</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>其他系统, 如Debian9 系统显示如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ob001:~# cat /etc/os-release</span><br><span class="line">PRETTY_NAME=&quot;Debian GNU/Linux 9 (stretch)&quot;</span><br><span class="line">NAME=&quot;Debian GNU/Linux&quot;</span><br><span class="line">VERSION_ID=&quot;9&quot;</span><br><span class="line">VERSION=&quot;9 (stretch)&quot;</span><br><span class="line">VERSION_CODENAME=stretch</span><br><span class="line">ID=debian</span><br><span class="line">HOME_URL=&quot;https://www.debian.org/&quot;</span><br><span class="line">SUPPORT_URL=&quot;https://www.debian.org/support&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;</span><br></pre></td></tr></table></figure>
<p>在unbutu 系统上:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NAME=&quot;Ubuntu&quot;</span><br><span class="line">VERSION=&quot;20.04.2 LTS (Focal Fossa)&quot;</span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=&quot;Ubuntu 20.04.2 LTS&quot;</span><br><span class="line">VERSION_ID=&quot;20.04&quot;</span><br><span class="line">HOME_URL=&quot;https://www.ubuntu.com/&quot;</span><br><span class="line">SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;</span><br><span class="line">PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span><br><span class="line">VERSION_CODENAME=focal</span><br><span class="line">UBUNTU_CODENAME=focal</span><br></pre></td></tr></table></figure>


<p>对于一些系统, 如Ubuntu&#x2F;Debian, 需要安装yum:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install build-essential </span><br><span class="line">sudo apt-get install yum -y</span><br><span class="line">sudo apt install yum-utils -y</span><br><span class="line">sudo ln -s /bin/bash /bin/sh</span><br><span class="line">apt-get install alien -y</span><br><span class="line">apt-get install rpm</span><br></pre></td></tr></table></figure>




<pre><code> 3. 查看内核版本, 要求操作系统3.10.0 及以上
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-01 /root]#uname -r </span><br><span class="line">3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="检查内存"><a href="#检查内存" class="headerlink" title="检查内存"></a>检查内存</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -g</span><br></pre></td></tr></table></figure>
<p>企业级应用最低要求64G,  推荐256G 及以上<br>如果free -g<br>​<img data-src="/img/ob/install3.png"><br>显示的free列的内存小于配置文件中的memory_limit配置, 需要清理缓存或者修改配置memory_limit, 将memory_limit修改小于free 列的值. 清理缓存操作如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># echo 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>
<p>​</p>
<h2 id="检查磁盘"><a href="#检查磁盘" class="headerlink" title="检查磁盘"></a>检查磁盘</h2><p>​</p>
<p>确保配置文件中, <code>data_dir, redo_dir, home_path</code>,  对应的磁盘已经完成挂载,   data_dir和redo_dir 对应目录为空, data_dir 对应目录的磁盘已经使用率必须低于4%.<br>​<img data-src="/img/ob/install4.png"></p>
<h2 id="检查网卡名称"><a href="#检查网卡名称" class="headerlink" title="检查网卡名称"></a>检查网卡名称</h2><p>​<img data-src="/img/ob/install5.png"><br>配置文件中, 有一个配置项”devname” 需要指定网卡. 在启动 OBServer 服务时，需要通过“-i”参数指定网卡，服务器有 可能有多个网卡以及多个 IP，OBServer 之间通信依赖指定的网卡和 IP。可以通过 ifconfig 命令查看网卡名称 (需要先安装 net-tools 依赖 包)，确保存在有效的网卡即可。<br>在本例中:<br>​<img data-src="/img/ob/install6.png"></p>
<h2 id="配置limits-conf"><a href="#配置limits-conf" class="headerlink" title="配置limits.conf"></a>配置limits.conf</h2><p>ulimit 用于限制 shell 启动进程所占用的资源。个人测试使用,可以不用设置, 但企业用户必须设置.<br>有两种方法可以修 改资源限制，一种是通过启动时 session 级别指定，另外一种是修改 &#x2F;etc&#x2F;security&#x2F;limits.conf 配置文件，全局生效。<br>OBServer 进程涉及的几个限制包括线程最大栈空间大小(stack)， 最大文件句柄数(open files)，core 文件大小(core file size)。<br>如下在启动 OBServer 进程时，session 级别设置最大栈空间大小 为 unlimited，最大文件句柄数为 655350，core 文件大小为 unlimited </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$vi /etc/security/limits.conf 添加</span><br><span class="line">root soft nofile 655350</span><br><span class="line">root hard nofile 655350</span><br><span class="line">* soft nofile 655350</span><br><span class="line">* hard nofile 655350</span><br><span class="line">* soft stack 20480</span><br><span class="line">* hard stack 20480</span><br><span class="line">* soft nproc 655360</span><br><span class="line">* hard nproc 655360</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br></pre></td></tr></table></figure>
<pre><code> 退出当前session, 重新登录
</code></pre>
<p>​</p>
<p>检查配置是否生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ulimit -a</span><br><span class="line"># 执行该命令，资源限制详情如下 (blocks, -c) 0</span><br><span class="line">core file size</span><br><span class="line">data seg size scheduling priority file size</span><br><span class="line">pending signals max locked memory</span><br><span class="line">(kbytes, -d) unlimited (-e) 0</span><br><span class="line">(blocks, -f) unlimited (-i) 772861</span><br><span class="line">(kbytes, -l) 64</span><br><span class="line">max memory size</span><br><span class="line">open files</span><br><span class="line">pipe size</span><br><span class="line">POSIX message queues real-time priority</span><br><span class="line">stack size</span><br><span class="line">cpu time</span><br><span class="line">max user processes virtual memory file locks</span><br><span class="line">(kbytes, -m) unlimited (-n) 1024</span><br><span class="line">(512 bytes, -p) 8</span><br><span class="line">(bytes, -q) 819200</span><br><span class="line">(-r) 0 (kbytes, -s) 8192</span><br><span class="line">(seconds, -t) unlimited (-u) 655360</span><br><span class="line">(kbytes, -v) unlimited (-x) unlimited</span><br></pre></td></tr></table></figure>
<p>​</p>
<h2 id="配置“sysctl-conf”文件"><a href="#配置“sysctl-conf”文件" class="headerlink" title="配置“sysctl.conf”文件"></a>配置“sysctl.conf”文件</h2><p>为保证 OceanBase 正常运行，请在安装 OceanBase 前修改所有物理机的“&#x2F;etc&#x2F;sysctl.conf”配置(用以提高 Linux 的系统性能)。</p>
<p>有一些参数, 操作系统已经提前设置了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># for oceanbase</span><br><span class="line">## 修改内核异步 I/O 限制</span><br><span class="line">fs.aio-max-nr=1048576</span><br><span class="line"></span><br><span class="line">## 网络优化</span><br><span class="line">net.core.somaxconn = 2048</span><br><span class="line">net.core.netdev_max_backlog = 10000 </span><br><span class="line">net.core.rmem_default = 16777216 </span><br><span class="line">net.core.wmem_default = 16777216 </span><br><span class="line">net.core.rmem_max = 16777216 </span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.ip_local_port_range = 3500 65535 </span><br><span class="line">net.ipv4.ip_forward = 0 </span><br><span class="line">net.ipv4.conf.default.rp_filter = 1 </span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0 </span><br><span class="line">net.ipv4.tcp_syncookies = 0 </span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 16777216 </span><br><span class="line">net.ipv4.tcp_wmem = 4096 65536 16777216 </span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384 </span><br><span class="line">net.ipv4.tcp_fin_timeout = 15 </span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384 </span><br><span class="line">net.ipv4.tcp_tw_reuse = 1 </span><br><span class="line">net.ipv4.tcp_tw_recycle = 1 </span><br><span class="line">net.ipv4.tcp_slow_start_after_idle=0</span><br><span class="line"></span><br><span class="line">vm.swappiness = 0</span><br><span class="line">vm.min_free_kbytes = 2097152</span><br><span class="line"></span><br><span class="line"># 此处为oceanbase 的data 目录</span><br><span class="line">kernel.core_pattern = /data/core-%e-%p-%t </span><br></pre></td></tr></table></figure>
<p>其中, “kernel.core_pattern &#x3D; &#x2F;data&#x2F;core-%e-%p-%t ”,  &#x2F;data 为 oceanbase的data 目录,  另外如果是个人测试, 也可以只设置 “fs.aio-max-nr&#x3D;1048576”<br>​</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置生效</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<p>​</p>
<h2 id="关闭防火墙和-SELinux"><a href="#关闭防火墙和-SELinux" class="headerlink" title="关闭防火墙和 SELinux"></a>关闭防火墙和 SELinux</h2><p>个人测试可以不用设置, 但企业用户建议进行设置</p>
<h3 id="firewalld关闭"><a href="#firewalld关闭" class="headerlink" title="firewalld关闭"></a>firewalld关闭</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#依次执行这 3 条命令 </span><br><span class="line">systemctl disable firewalld </span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure>

<h3 id="selinux关闭"><a href="#selinux关闭" class="headerlink" title="selinux关闭"></a>selinux关闭</h3><p>vi &#x2F;etc&#x2F;selinux&#x2F;linux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>
<p>执行该命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">#查看配置已生效</span><br><span class="line">cat /etc/selinux/config</span><br></pre></td></tr></table></figure>


<h2 id="设置时钟同步"><a href="#设置时钟同步" class="headerlink" title="设置时钟同步"></a>设置时钟同步</h2><p>当下面任一状况时, 可以跳过设置时钟同步:</p>
<ol>
<li>若 NTP 时钟已经处于同步状态</li>
<li>部署为单机版</li>
<li>个人测试</li>
</ol>
<p>​</p>
<p>OceanBase 集群中各服务器的时间需保持一致，否则会导致 OceanBase 集群无法启动，运行时也会出现故障。对于企业用户来说, 时钟同步是<strong>非常非常重要</strong>, 物理机与时钟服务器的误差在 50ms 以下可认为时钟是同步状态 , 最大容忍误差不能超过200ms. 当超过200ms, 会出现无主状况, 恢复时钟同步后, 重启observer, 可以恢复状态. </p>
<h3 id="检查时钟同步"><a href="#检查时钟同步" class="headerlink" title="检查时钟同步"></a>检查时钟同步</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo clockdiff  $IP</span><br></pre></td></tr></table></figure>

<h3 id="配置时钟同步"><a href="#配置时钟同步" class="headerlink" title="配置时钟同步"></a>配置时钟同步</h3><p><a target="_blank" rel="noopener" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/optional-configuring-clock-sources">https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/optional-configuring-clock-sources</a><br>​</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装包组件"><a href="#安装包组件" class="headerlink" title="安装包组件"></a>安装包组件</h2><p>从<a target="_blank" rel="noopener" href="https://open.oceanbase.com/softwareCenter/community">https://open.oceanbase.com/softwareCenter/community</a> 上下载所有的安装包, 本文展示的安装包的版本,可能已经过期, 麻烦从开源OceanBase官网下载最新版本的安装包.<br>​<img data-src="/img/ob/install7.png"><br>如您的机器可以访问公网，并能够添加三方 YUM 软件源，您可以运行以下命令，使用 OceanBase 的官方软件源安装 OBD：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo</span><br><span class="line">sudo yum install -y ob-deploy</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>将所有的软件包, scp至 主控机器上</p>
<p>​</p>
<h2 id="安装OBD"><a href="#安装OBD" class="headerlink" title="安装OBD"></a>安装OBD</h2><p>当前使用root 用户, 当前操作只在主控机器上进行操作</p>
<h3 id="在线安装"><a href="#在线安装" class="headerlink" title="在线安装"></a>在线安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ob-deploy</span><br></pre></td></tr></table></figure>

<h3 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h3><p>centos或redhat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ob-deploy-1.1.0-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>Ubuntu&#x2F;Debian</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alien -i ob-deploy-1.1.0-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>


<h2 id="安装OBLibs"><a href="#安装OBLibs" class="headerlink" title="安装OBLibs"></a>安装OBLibs</h2><p>当前使用root 用户, 需要在每台机器上执行,  </p>
<h3 id="在线安装-1"><a href="#在线安装-1" class="headerlink" title="在线安装"></a>在线安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y oceanbase-ce-libs</span><br></pre></td></tr></table></figure>

<h3 id="本地安装-1"><a href="#本地安装-1" class="headerlink" title="本地安装"></a>本地安装</h3><p>先将oceanbase-ce-libs-3.1.0-3.el7.x86_64.rpm 拷贝到每台机器下<br>​</p>
<p>centos或redhat或anolis</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install oceanbase-ce-libs-3.1.0-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>Ubuntu&#x2F;Debian</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alien -i oceanbase-ce-libs-3.1.0-3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>


<h2 id="安装OBServer-OBProxy"><a href="#安装OBServer-OBProxy" class="headerlink" title="安装OBServer &amp; OBProxy"></a>安装OBServer &amp; OBProxy</h2><p>切换到admin 用户下<br>​</p>
<h3 id="将OceanBase数据库的离线软件包加入本地镜像"><a href="#将OceanBase数据库的离线软件包加入本地镜像" class="headerlink" title="将OceanBase数据库的离线软件包加入本地镜像"></a>将OceanBase数据库的离线软件包加入本地镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:/data/rpm$ obd mirror clone *.rpm</span><br><span class="line">name: libobclient</span><br><span class="line">version: 2.0.0</span><br><span class="line">release:2.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: f73cae67e2ff5be0682ac2803aba33a7ed26430e</span><br><span class="line">add libobclient-2.0.0-2.el7.x86_64.rpm to local mirror</span><br><span class="line">name: obclient</span><br><span class="line">version: 2.0.0</span><br><span class="line">release:2.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: 1d2c3ee31f40b9d2fbf97f653f549d896b7e7060</span><br><span class="line">add obclient-2.0.0-2.el7.x86_64.rpm to local mirror</span><br><span class="line">name: ob-deploy</span><br><span class="line">version: 1.1.0</span><br><span class="line">release:1.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: c01dbbebc7f44b700833ce6846df09f20033675c</span><br><span class="line">add ob-deploy-1.1.0-1.el7.x86_64.rpm to local mirror</span><br><span class="line">name: obproxy</span><br><span class="line">version: 3.1.0</span><br><span class="line">release:1.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: 0b17cf0459a3b53c5a2febb6572894d183154c64</span><br><span class="line">add obproxy-3.1.0-1.el7.x86_64.rpm to local mirror</span><br><span class="line">name: oceanbase-ce</span><br><span class="line">version: 3.1.0</span><br><span class="line">release:3.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: b73bcd531bdf3f087391991b290ff2cbcdaa0dc9</span><br><span class="line">add oceanbase-ce-3.1.0-3.el7.x86_64.rpm to local mirror</span><br><span class="line">name: oceanbase-ce-libs</span><br><span class="line">version: 3.1.0</span><br><span class="line">release:3.el7</span><br><span class="line">arch: x86_64</span><br><span class="line">md5: 528144ec7ff0194a8b326491a396b8f5c87b1eaa</span><br><span class="line">add oceanbase-ce-libs-3.1.0-3.el7.x86_64.rpm to local mirror</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:~$ obd mirror list local</span><br><span class="line">+-------------------------------------------------------------------------------------------+</span><br><span class="line">|                                     local Package List                                    |</span><br><span class="line">+-------------------+---------+---------+--------+------------------------------------------+</span><br><span class="line">| name              | version | release | arch   | md5                                      |</span><br><span class="line">+-------------------+---------+---------+--------+------------------------------------------+</span><br><span class="line">| libobclient       | 2.0.0   | 2.el7   | x86_64 | f73cae67e2ff5be0682ac2803aba33a7ed26430e |</span><br><span class="line">| obclient          | 2.0.0   | 2.el7   | x86_64 | 1d2c3ee31f40b9d2fbf97f653f549d896b7e7060 |</span><br><span class="line">| ob-deploy         | 1.1.0   | 1.el7   | x86_64 | c01dbbebc7f44b700833ce6846df09f20033675c |</span><br><span class="line">| obproxy           | 3.1.0   | 1.el7   | x86_64 | 0b17cf0459a3b53c5a2febb6572894d183154c64 |</span><br><span class="line">| oceanbase-ce      | 3.1.0   | 3.el7   | x86_64 | b73bcd531bdf3f087391991b290ff2cbcdaa0dc9 |</span><br><span class="line">| oceanbase-ce-libs | 3.1.0   | 3.el7   | x86_64 | 528144ec7ff0194a8b326491a396b8f5c87b1eaa |</span><br><span class="line">+-------------------+---------+---------+--------+------------------------------------------+</span><br></pre></td></tr></table></figure>


<h3 id="下载配置文件"><a href="#下载配置文件" class="headerlink" title="下载配置文件"></a>下载配置文件</h3><p>到<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/oceanbase/obdeploy/tree/master/example/autodeploy">https://github.com/oceanbase/obdeploy/tree/master/example/autodeploy</a> 上将所有配置文件下载下来<br>当前有几个配置文件:<br>​</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/oceanbase/obdeploy/blob/master/example/autodeploy/distributed-example.yaml">distributed-example.yaml</a>    :  分布式example</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/oceanbase/obdeploy/blob/master/example/autodeploy/distributed-with-obproxy-example.yaml">distributed-with-obproxy-example.yaml</a>  : 分布式带obproxy的example</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/oceanbase/obdeploy/blob/master/example/autodeploy/single-example.yaml">single-example.yaml</a>  : 单机example</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/oceanbase/obdeploy/blob/master/example/autodeploy/single-with-obproxy-example.yaml">single-with-obproxy-example.yaml</a>  : 单机example</li>
</ul>
<p>​</p>
<p>在本例中, 我们使用分布式example, 我们将分布式配置文件 scp到 主控机器上. </p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>本例中, 以distributed-with-obproxy-example.yaml为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">## Only need to configure when remote login is required</span><br><span class="line"># user:</span><br><span class="line">#   username: your username</span><br><span class="line">#   password: your password if need</span><br><span class="line">#   key_file: your ssh-key file path if need</span><br><span class="line">#   port: your ssh port, default 22</span><br><span class="line">#   timeout: ssh connection timeout (second), default 30</span><br><span class="line">oceanbase-ce:</span><br><span class="line">  servers:</span><br><span class="line">    - name: z1</span><br><span class="line">      # Please don&#x27;t use hostname, only IP can be supported</span><br><span class="line">      ip: 192.168.1.2</span><br><span class="line">    - name: z2</span><br><span class="line">      ip: 192.168.1.3</span><br><span class="line">    - name: z3</span><br><span class="line">      ip: 192.168.1.4</span><br><span class="line">  global:</span><br><span class="line">    # The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.</span><br><span class="line">    home_path: /root/observer</span><br><span class="line">    # The directory for data storage. The default value is $home_path/store.</span><br><span class="line">    # data_dir: /data</span><br><span class="line">    # The directory for clog, ilog, and slog. The default value is the same as the data_dir value.</span><br><span class="line">    # redo_dir: /redo</span><br><span class="line">    # External port for OceanBase Database. The default value is 2881.</span><br><span class="line">    # mysql_port: 2881</span><br><span class="line">    # Internal port for OceanBase Database. The default value is 2882.</span><br><span class="line">    # rpc_port: 2882</span><br><span class="line">    # Defines the zone for an observer. The default value is zone1.</span><br><span class="line">    # zone: zone1</span><br><span class="line">    # The maximum running memory for an observer. When ignored, autodeploy calculates this value based on the current server available resource.</span><br><span class="line">    # memory_limit: 58G</span><br><span class="line">    # The percentage of the maximum available memory to the total memory. This value takes effect only when memory_limit is 0. The default value is 80.</span><br><span class="line">    # memory_limit_percentage: 80 </span><br><span class="line">    # The reserved system memory. system_memory is reserved for general tenants. The default value is 30G. Autodeploy calculates this value based on the current server available resource.</span><br><span class="line">    # system_memory: 22G</span><br><span class="line">    # The size of a data file. When ignored, autodeploy calculates this value based on the current server available resource.</span><br><span class="line">    # datafile_size: 200G</span><br><span class="line">    # The percentage of the data_dir space to the total disk space. This value takes effect only when datafile_size is 0. The default value is 90.</span><br><span class="line">    # datafile_disk_percentage: 90</span><br><span class="line">    # System log level. The default value is INFO.</span><br><span class="line">    # syslog_level: INFO</span><br><span class="line">    # Print system logs whose levels are higher than WARNING to a separate log file. The default value is true. The default value for autodeploy mode is false.</span><br><span class="line">    # enable_syslog_wf: false</span><br><span class="line">    # Enable auto system log recycling or not. The default value is false. The default value for autodeploy mode is on.</span><br><span class="line">    # enable_syslog_recycle: true</span><br><span class="line">    # The maximum number of reserved log files before enabling auto recycling. When set to 0, no logs are deleted. The default value for autodeploy mode is 4.</span><br><span class="line">    # max_syslog_file_count: 4</span><br><span class="line">    # Cluster name for OceanBase Database. The default value is obcluster. When you deploy OceanBase Database and obproxy, this value must be the same as the cluster_name for obproxy.</span><br><span class="line">    # appname: obcluster</span><br><span class="line">    # Password for root. The default value is empty.</span><br><span class="line">    # root_password:</span><br><span class="line">    # Password for proxyro. proxyro_password must be the same as observer_sys_password. The default value is empty.</span><br><span class="line">    # proxyro_password:</span><br><span class="line">  z1:</span><br><span class="line">    zone: zone1</span><br><span class="line">  z2:</span><br><span class="line">    zone: zone2</span><br><span class="line">  z3:</span><br><span class="line">    zone: zone3</span><br><span class="line">obproxy:</span><br><span class="line">  servers:</span><br><span class="line">    - 192.168.1.5</span><br><span class="line">  global:</span><br><span class="line">    # The working directory for obproxy. Obproxy is started under this directory. This is a required field.</span><br><span class="line">    home_path: /root/obproxy</span><br><span class="line">    # External port. The default value is 2883.</span><br><span class="line">    # listen_port: 2883</span><br><span class="line">    # The Prometheus port. The default value is 2884.</span><br><span class="line">    # prometheus_listen_port: 2884</span><br><span class="line">    # rs_list is the root server list for observers. The default root server is the first server in the zone.</span><br><span class="line">    # The format for rs_list is observer_ip:observer_mysql_port;observer_ip:observer_mysql_port.</span><br><span class="line">    # Ignore this value in autodeploy mode.</span><br><span class="line">    # rs_list: 127.0.0.1:2881</span><br><span class="line">    # Cluster name for the proxy OceanBase Database. The default value is obcluster. This value must be set to the same with the appname for OceanBase Database.</span><br><span class="line">    # cluster_name: obcluster</span><br><span class="line">    # Password for obproxy system tenant. The default value is empty.</span><br><span class="line">    # obproxy_sys_password:</span><br><span class="line">    # Password for proxyro. proxyro_password must be the same with proxyro_password. The default value is empty.</span><br><span class="line">    # observer_sys_password:</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## Only need to configure when remote login is required</span><br><span class="line"># user:</span><br><span class="line">#   username: your username</span><br><span class="line">#   password: your password if need</span><br><span class="line">#   key_file: your ssh-key file path if need</span><br><span class="line">#   port: your ssh port, default 22</span><br><span class="line">#   timeout: ssh connection timeout (second), default 30</span><br></pre></td></tr></table></figure>
<p>修改用户名和密码<br>​</p>
<p>通常这几个变量需要人肉设置一下, 每台机器的ip,  home_path, data_dir, redo_dir,  在本例中, 分别修改为&#x2F;home&#x2F;admin&#x2F;oceanbase&#x2F;ob, &#x2F;data&#x2F;ob, &#x2F;redo&#x2F;ob,  分别为之前挂载的磁盘. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">oceanbase-ce:</span><br><span class="line">  servers:</span><br><span class="line">    - name: z1</span><br><span class="line">      # Please don&#x27;t use hostname, only IP can be supported</span><br><span class="line">      ip: 172.30.62.200</span><br><span class="line">    - name: z2</span><br><span class="line">      ip: 172.30.62.201</span><br><span class="line">    - name: z3</span><br><span class="line">      ip: 172.30.62.202</span><br><span class="line">  global:</span><br><span class="line">    # The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.</span><br><span class="line">    home_path: /home/admin/oceanbase/ob</span><br><span class="line">    # The directory for data storage. The default value is $home_path/store.</span><br><span class="line">    data_dir: /data/ob</span><br><span class="line">    # The directory for clog, ilog, and slog. The default value is the same as the data_dir value.</span><br><span class="line">    redo_dir: /redo/ob</span><br></pre></td></tr></table></figure>


<p>配置proxy,  修改ip 和home_path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obproxy:</span><br><span class="line">  servers:</span><br><span class="line">    - 172.30.62.203</span><br><span class="line">  global:</span><br><span class="line">    # The working directory for obproxy. Obproxy is started under this directory. This is a required field.</span><br><span class="line">    home_path: /home/admin/oceanbase</span><br></pre></td></tr></table></figure>


<p>另外推荐一个网站<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.bejson.com/validators/yaml_editor/">https://www.bejson.com/validators/yaml_editor&#x2F;</a>, 可以对配置文件进行yaml 检测, 很多时候, 配置文件 多一个空格, 少一个空格, 极难发现,<br>​</p>
<p>​</p>
<h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><p>对于离线安装, 需要执行一步操作, 当连不上服务器, 需要把远程的repo 配置给删掉, 避免浪费时间消耗在连接远程的repo 之上. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -fr ~/.obd/mirror/remote/*.repo</span><br></pre></td></tr></table></figure>
<p>开始安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:~$ obd cluster autodeploy obtest -c distributed-with-obproxy-example.yaml </span><br></pre></td></tr></table></figure>






<p>检查安装是否成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:~$ obd cluster list</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">|                        Cluster List                        |</span><br><span class="line">+--------+---------------------------------+-----------------+</span><br><span class="line">| Name   | Configuration Path              | Status (Cached) |</span><br><span class="line">+--------+---------------------------------+-----------------+</span><br><span class="line">| obtest | /home/admin/.obd/cluster/obtest | running         |</span><br><span class="line">+--------+---------------------------------+-----------------+</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:~$ obd cluster display obtest</span><br><span class="line">Get local repositories and plugins ok</span><br><span class="line">Open ssh connection ok</span><br><span class="line">Cluster status check ok</span><br><span class="line">Connect to observer ok</span><br><span class="line">Wait for observer init ok</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">|                     observer                    |</span><br><span class="line">+---------------+---------+------+-------+--------+</span><br><span class="line">| ip            | version | port | zone  | status |</span><br><span class="line">+---------------+---------+------+-------+--------+</span><br><span class="line">| 172.30.62.200 | 3.1.0   | 2881 | zone1 | active |</span><br><span class="line">| 172.30.62.201 | 3.1.0   | 2881 | zone2 | active |</span><br><span class="line">| 172.30.62.202 | 3.1.0   | 2881 | zone3 | active |</span><br><span class="line">+---------------+---------+------+-------+--------+</span><br><span class="line"></span><br><span class="line">Connect to obproxy ok</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">|                     obproxy                     |</span><br><span class="line">+---------------+------+-----------------+--------+</span><br><span class="line">| ip            | port | prometheus_port | status |</span><br><span class="line">+---------------+------+-----------------+--------+</span><br><span class="line">| 172.30.62.203 | 2883 | 2884            | active |</span><br><span class="line">+---------------+------+-----------------+--------+</span><br></pre></td></tr></table></figure>

<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>OceanBase 数据库有数百个配置项，有些配置是耦合的，在您熟悉 OceanBase 数据库之前，不建议您修改示例配件文件中的配置。此处示例用来说明如何修改配置，并使之生效。<br>​</p>
<p>所有的参数介绍请参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/oceanbase/obdeploy/blob/master/plugins/oceanbase/3.1.0/parameter.yaml</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用 edit-config 命令进入编辑模式，修改集群配置</span><br><span class="line">obd cluster edit-config lo</span><br><span class="line"># 修改 sys_bkgd_migration_retry_num 为 5</span><br><span class="line"># 注意 sys_bkgd_migration_retry_num 值最小为 3</span><br><span class="line"># 保存并退出后，OBD 会告知您如何使得此次改动生效</span><br><span class="line"># 此配置项仅需要 reload 即可生效</span><br><span class="line">obd cluster reload lo</span><br></pre></td></tr></table></figure>

<h1 id="验证​"><a href="#验证​" class="headerlink" title="验证​"></a>验证​</h1><h2 id="安装obclient"><a href="#安装obclient" class="headerlink" title="安装obclient"></a>安装obclient</h2><p>通常在主控机器上安装obclient,  需要切换到root 账号</p>
<h3 id="在线安装-2"><a href="#在线安装-2" class="headerlink" title="在线安装"></a>在线安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libobclient</span><br><span class="line">yum install -y obclient</span><br></pre></td></tr></table></figure>

<h3 id="本地安装-2"><a href="#本地安装-2" class="headerlink" title="本地安装"></a>本地安装</h3><p>​</p>
<p>centos或redhat或anolis</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install libobclient-2.0.0-2.el7.x86_64.rpm</span><br><span class="line">yum install obclient-2.0.0-2.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>Ubuntu&#x2F;Debian</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alien -i libobclient-2.0.0-2.el7.x86_64.rpm</span><br><span class="line">alien -i obclient-2.0.0-2.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>在debian 下需要把路径设置到系统环境变量中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/app/mariadb/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>在ubuntu下需要把路径设置到系统环境变量中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/u01/obclient/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>​</p>
<h2 id="安装mysql-开发包"><a href="#安装mysql-开发包" class="headerlink" title="安装mysql 开发包"></a>安装mysql 开发包</h2><p>如果需要运行sysbench, 或者tpch 等程序, 需要安装mysql 开发包</p>
<p>​</p>
<p>centos或redhat或anolis</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb</span><br><span class="line">yum install mariadb-libs</span><br><span class="line">yum install mariadb-devel</span><br></pre></td></tr></table></figure>
<p>Ubuntu</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mariadb-server</span><br></pre></td></tr></table></figure>
<p>Debian</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mysql-server mysql-client libmariadbd18 libmariadbd-dev</span><br></pre></td></tr></table></figure>



<h2 id="检查租户"><a href="#检查租户" class="headerlink" title="检查租户"></a>检查租户</h2><p>使用oceanbase, 需要创建租户, 用户真正应用必须运行在租户下<br>创建租户有2种方式:<br>可以使用obd 来创建租户, 使用obd 创建租户时, 会把所有的资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obd cluster tenant create $&#123;cluster_name&#125; -n $&#123;tenant_name&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
<p>创建租户, 请参考<br><a target="_blank" rel="noopener" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/create-a-user-tenant">https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/create-a-user-tenant</a><br>​</p>
<p>在本例中:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">admin@obdriver:~$ mysql -h$&#123;obproxy_ip&#125; -P$&#123;obproxy_port&#125; -uroot</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.6.25 OceanBase 3.1.0 (r3-b20901e8c84d3ea774beeaca963c67d7802e4b4e) (Built Aug 10 2021 07:51:04)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; use oceanbase;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MySQL [oceanbase]&gt; select * from gv$tenant;</span><br><span class="line">+-----------+-------------+-------------------+-------------------+----------------+---------------+-----------+---------------------------------------------+</span><br><span class="line">| tenant_id | tenant_name | zone_list         | primary_zone      | collation_type | info          | read_only | locality                                    |</span><br><span class="line">+-----------+-------------+-------------------+-------------------+----------------+---------------+-----------+---------------------------------------------+</span><br><span class="line">|         1 | sys         | zone1;zone2;zone3 | zone1;zone2,zone3 |              0 | system tenant |         0 | FULL&#123;1&#125;@zone1, FULL&#123;1&#125;@zone2, FULL&#123;1&#125;@zone3 |</span><br><span class="line">|      1001 | mytest      | zone1;zone2;zone3 | RANDOM            |              0 |               |         0 | FULL&#123;1&#125;@zone1, FULL&#123;1&#125;@zone2, FULL&#123;1&#125;@zone3 |</span><br><span class="line">+-----------+-------------+-------------------+-------------------+----------------+---------------+-----------+---------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt;</span><br></pre></td></tr></table></figure>
<p>​</p>
<h1 id="企业用户最佳实践"><a href="#企业用户最佳实践" class="headerlink" title="企业用户最佳实践"></a>企业用户最佳实践</h1><h2 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h2><p>ob  运行日志, 事务日志, 数据文件 必须独立开, 如果没有3块盘支持, 则可以一块盘分3块分区<br>​</p>
<h2 id="时钟依赖"><a href="#时钟依赖" class="headerlink" title="时钟依赖"></a>时钟依赖</h2><p>OceanBase 集群中各服务器的时间需保持一致，否则会导致 OceanBase 集群无法启动，运行时也会出现故障。对于企业用户来说, 时钟同步是<strong>非常非常重要</strong>, 物理机与时钟服务器的误差在 50ms 以下可认为时钟是同步状态 , 最大容忍误差不能超过200ms. 当超过200ms, 会出现无主状况, 恢复时钟同步后, 重启observer, 可以恢复状态.<br>​</p>
<h2 id="网络时延"><a href="#网络时延" class="headerlink" title="网络时延"></a>网络时延</h2><p>server间的网络时延不能超过200ms，否则同步会严重滞后, 并且可能影响选举<br>网卡设置<br>建议配置2块万兆网卡，bond模式取名bond0，mode1或mode4均可以，推荐使用mode4，如果是mode4，交换机需要配置802.3ad。网卡名建议使用eth0，eth1。建议使用network服务，不要使用NetworkManager。</p>
<h2 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h2><ul>
<li><p>当系统写入tps 过高时, 超过系统支撑能力时, 为防止系统停止响应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter system set writing_throttling_trigger_percentage=75 tenant=all(或者具体tenantname);</span><br></pre></td></tr></table></figure>

</li>
<li><p>除非业务应用有配置重连尝试，否则建议关闭轮转合并, 切主也不能保证不杀事务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER SYSTEM SET enable_merge_by_turn = &#x27;False&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>内存设置</p>
<ul>
<li>租户的cpu和内存规格比建议不低于1:4,否则容易oom； </li>
<li>普通租户最小内存规格暂定5G以上；</li>
<li>租户内存太小时建议调大ob_sql_work_area_percentage，默认值5%，租户内存小于10G建议配20%左右；</li>
<li>partition 个数限制, 单机建议不要超过10万个分区, 另外partition 数量会受内存限制,  每个副本预留内存为168KB，因此10000个副本至少需要预留1.68G内存，或者说1G的租户最多能建6k左右个partition，需要根据partition数的规划设置租户内存；另外单机. </li>
<li>物理内存使用限制，默认为80，memstore内存可用百分比，建议服务器内存256G以上配置调整为90，256G以下保持默认50<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER SYSTEM SET memstore_limit_percentage = &#x27;90&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>​</p>
<ul>
<li><p>slow query阈值调整 trace_log_slow_query_watermark 默认100ms，可以根据业务特点调整。如果阈值设置的太小，打印大量trace日志会影响性能.MySQL  默认值是1s. 大查询时间为10s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ALTER SYSTEM SET trace_log_slow_query_watermark = &#x27;1s&#x27;;</span><br><span class="line">ALTER SYSTEM SET large_query_threshold = &#x27;10s&#x27;;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>cpu 并发度调整</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- CPU并发度参数，建议配置为4，arm系统为2</span><br><span class="line">ALTER SYSTEM SET cpu_quota_concurrency = &#x27;4&#x27;;</span><br><span class="line"></span><br><span class="line">-- 资源软负载开关，控制资源均衡水位，默认为50%，即CPU内存使用超过50%就进行unit均衡，线上建议调整为100，达到手工控制unit分布的效果</span><br><span class="line">ALTER SYSTEM SET resource_soft_limit = &#x27;100&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>转储合并相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 配置转储50次</span><br><span class="line">ALTER SYSTEM SET minor_freeze_times = 50;</span><br><span class="line"></span><br><span class="line">-- 转储触发水位百分比，建议256G以上配置调整为70，256G以下调整为60</span><br><span class="line">ALTER SYSTEM SET freeze_trigger_percentage = &#x27;60&#x27;;</span><br><span class="line"></span><br><span class="line">-- 数据拷贝并发为100</span><br><span class="line">ALTER SYSTEM SET data_copy_concurrency = 100;</span><br><span class="line">-- 服务器上数据传出并发为10</span><br><span class="line">ALTER SYSTEM SET server_data_copy_out_concurrency = 10;</span><br><span class="line">-- 服务器上数据传入并发为10</span><br><span class="line">ALTER SYSTEM SET server_data_copy_in_concurrency = 10;</span><br><span class="line"></span><br><span class="line">-- 转储预热时间，默认30s，设置了会延后转储释放的时间，改成0s</span><br><span class="line">ALTER SYSTEM SET minor_warm_up_duration_time = &#x27;0s&#x27;;</span><br><span class="line">-- 配置chunk内存大小(建议保持默认值0，ob自行分配)</span><br><span class="line">ALTER SYSTEM SET memory_chunk_cache_size = 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 最大包括版本数量，影响磁盘可用空间，默认为2，将多保留一个版本的数据在数据盘中，需调整为1</span><br><span class="line">ALTER SYSTEM SET max_kept_major_version_number = &#x27;1&#x27;;</span><br><span class="line">ALTER SYSTEM SET max_stale_time_for_weak_consistency = &#x27;2h&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>事务相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER SYSTEM SET clog_sync_time_warn_threshold = &#x27;1s&#x27;;</span><br><span class="line">ALTER SYSTEM SET trx_try_wait_lock_timeout = &#x27;0ms&#x27;;（默认就是 0ms，无需修改）</span><br><span class="line"></span><br><span class="line">-- 建议关闭一阶段提交，该参数值默认是false</span><br><span class="line">ALTER SYSTEM SET enable_one_phase_commit=&#x27;False&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分区迁移速度控制, 若是集群负载很低，可以通过加大并发任务数加快 partition迁移速度, 调大迁移并发数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter system set data_copy_concurrency=40;</span><br><span class="line">alter system set server_data_copy_out_concurrency=20;</span><br><span class="line">alter system set server_data_copy_in_concurrency=20;</span><br></pre></td></tr></table></figure>
</li>
<li><p>压缩相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- （默认就是 zstd_1.0，无需修改）, 不过系统支持多种压缩算法</span><br><span class="line">ALTER SYSTEM SET default_compress_func = &#x27;zstd_1.0&#x27;;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>cache 刷新相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER SYSTEM SET autoinc_cache_refresh_interval = &#x27;43200s&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>prepare statement, server端ps受_ob_enable_prepared_statement开关控制，除了objdbc和oci的用户可以按照文档提供的说明使用server端ps，其他情况不建议用了；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- Prepared Statement参数，不用java建联的配置建议设为0</span><br><span class="line">ALTER SYSTEM SET _ob_enable_prepared_statement = 0;</span><br></pre></td></tr></table></figure>
</li>
<li><p>系统相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER SYSTEM SET server_permanent_offline_time = &#x27;7200s&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- （公有云建议5M，外部环境建议5M，否则建议默认值30M）</span><br><span class="line">ALTER SYSTEM SET syslog_io_bandwidth_limit = &#x27;5M&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>集群升级策略, 在进行版本升级，机器临时上下线，可以先进行一次转储，可以减少启动observer时候恢复时间</p>
</li>
<li><p>批量导入大量数据最佳策略, 如果集群是多租户的，如果某个租户要大批量导入数据，为避免影响其他租户, 导完数据后可以恢复以上两个参数: </p>
<ul>
<li>1.调整 cpu_quota_concurrency &#x3D;1 ，防止租户间cpu抢占</li>
<li>开启多轮转储减少合并触发，这样可以提高导入速度</li>
</ul>
</li>
</ul>
<p>​</p>
<ul>
<li>租户primary_zone配置, <ul>
<li><p>primar_zone配置到具体某个zone中, 适用场景：业务使用单表、zone_name1与应用在同机房、zone_name2和zone_name3作为从副本平时无业务流量，具体zone顺序需按机房优先级、按应用和ob的机房配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TENANT SET PRIMARY_ZONE = &#x27;zone_name1;zone_name2,zone_name3&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打散primary_zone到所有全功能zone中, 使用场景：业务使用分区表、集群中所有副本都在同一机房或不同zone机房间网络延迟在1ms内，需要所有副</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TENANT SET PRIMARY_ZONE = &#x27;zone_name1,zone_name2,zone_name3&#x27;;</span><br></pre></td></tr></table></figure>




<h3 id="租户设置"><a href="#租户设置" class="headerlink" title="租户设置"></a>租户设置</h3><ul>
<li><p>并发度设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 最大并发度，默认32，有大查询业务的建议调整为128</span><br><span class="line">SET GLOBAL ob_max_parallel_degree = 128;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">parallel_max_servers 推荐设置为测试租户分配的 resource unit cpu 数的 10 倍</span><br><span class="line">如测试租户使用的 unit 配置为：create resource unit $unit_name max_cpu 26</span><br><span class="line">那么该值设置为 260</span><br><span class="line">parallel_server_target 推荐设置为 parallel_max_servers * 机器数*0.8</span><br><span class="line">那么该值为 260*3*0.8=624</span><br><span class="line">*/</span><br><span class="line">set global parallel_max_servers=260;</span><br><span class="line">set global parallel_servers_target=624;</span><br></pre></td></tr></table></figure>
</li>
<li><p>回收站设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 回收站参数，ddl执行频率过大的场景一定要关闭，避免ddl执行过多引起租户性能异常</span><br><span class="line">SET GLOBAL recyclebin = 0;</span><br><span class="line"></span><br><span class="line">-- truncate回滚参数，truncate执行频率过大的场景一定要关闭</span><br><span class="line">SET GLOBAL ob_enable_truncate_flashback = 0;</span><br></pre></td></tr></table></figure>

</li>
<li><p>客户端命令长度,  OB客户端可发的命令长度受限于租户系统变量_max_allowed_packet_的限制（缺省4M),可以酌情调大；</p>
</li>
</ul>
<h3 id="obproxy配置"><a href="#obproxy配置" class="headerlink" title="obproxy配置"></a>obproxy配置</h3><ul>
<li>obproxy探活<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alter proxyconfig set sock_option_flag_out = 2;  --  2代表keepalive</span><br><span class="line">alter proxyconfig set server_tcp_keepidle = 5;  --  启动keepalive探活前的idle时间，5秒。</span><br><span class="line">alter proxyconfig set server_tcp_keepintvl = 5;  -- 两个keepalive探活包之间的时间间隔，5秒</span><br><span class="line">alter proxyconfig set server_tcp_keepcnt = 2;  --  最多发送多少个keepalive包，2个。最长5+5*2=15秒发现dead_socket。</span><br><span class="line">alter proxyconfig set server_tcp_user_timeout = 5;  --  等待TCP层ACK确认消息的超时时长，5秒。</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/OceanBase/" rel="tag"># OceanBase</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/debug_ob/" rel="prev" title="《OceanBase开发者手册》之五 如何debug OceanBase">
                  <i class="fa fa-chevron-left"></i> 《OceanBase开发者手册》之五 如何debug OceanBase
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/obagent/" rel="next" title="OceanBase监控对接Prometheus/Grafana">
                  OceanBase监控对接Prometheus/Grafana <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备20005107号-2 </a>
      <img src="https://beian.miit.gov.cn" alt>
  </div>

<div class="copyright">
  &copy; 2014 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Powered by Longda Feng</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"forest","js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js","integrity":"sha256-blHXaX2RMvNwEOnrYOl/6/RKqNi97Ig3o6Ae3bhXPvM="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":false,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"http://ilongda.com/2021/ob_offline_install/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Longda-Feng/blog-comment","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
